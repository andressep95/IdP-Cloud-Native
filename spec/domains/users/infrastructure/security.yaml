# IAM Roles and Policies for Users Domain

iam_roles:
  # ============================================
  # Users Write Lambda Role
  # From: spec/domains/users/infrastructure/security.yaml
  # ============================================
  - name: users-write-lambda-role
    description: Execution role for Users write operations
    service: lambda.amazonaws.com

    managed_policies:
      - AWSLambdaBasicExecutionRole

    inline_policies:
      - name: users-write-dynamodb
        actions:
          - dynamodb:PutItem
          - dynamodb:UpdateItem
          - dynamodb:DeleteItem
        resources:
          - "arn:aws:dynamodb:*:*:table/idp-users"
          - "arn:aws:dynamodb:*:*:table/user_directory"

      - name: users-read-before-write

        actions:
          - dynamodb:GetItem
        resources:
          - "arn:aws:dynamodb:*:*:table/idp-users"

      - name: eventbridge-access
        actions:
          - events:PutEvents
        resources:
          - "arn:aws:events:*:*:event-bus/idp-event-bus"

  # ============================================
  # Users Read Lambda Role
  # From: spec/domains/users/infrastructure/security.yaml
  # ============================================
  - name: users-read-lambda-role
    description: Execution role for Users read operations
    service: lambda.amazonaws.com

    managed_policies:
      - AWSLambdaBasicExecutionRole

    inline_policies:
      - name: users-read-dynamodb
        actions:
          - dynamodb:GetItem
          - dynamodb:Query
        resources:
          - "arn:aws:dynamodb:*:*:table/idp-users"
          - "arn:aws:dynamodb:*:*:table/user_directory"
          - "arn:aws:dynamodb:*:*:table/user_directory/index/*"
